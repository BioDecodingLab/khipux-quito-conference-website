---
// Modal popup to notify users about deadline extension
---

<!-- Modal Backdrop -->
<div
  id="deadline-extension-modal"
  class="fixed inset-0 z-50 flex items-center justify-center bg-khipu-black/70 p-4 opacity-0 transition-opacity duration-300"
  style="display: none;"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
>
  <!-- Modal Card -->
  <div
    class="relative w-full max-w-md transform scale-95 rounded-xl border-2 border-khipu-orange bg-khipu-gray p-6 shadow-2xl transition-transform duration-300 md:p-8"
    id="modal-card"
  >
    <!-- Icon - Party Popper -->
    <div class="mb-4 flex justify-center">
      <svg
        class="h-20 w-20 md:h-24 md:w-24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        <!-- Party popper cone - Orange filled -->
        <path
          d="M3.53577 20.4645L7.0713 9.85791L14.1424 16.929L3.53577 20.4645Z"
          fill="#e95b30"
          stroke="#e95b30"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <!-- Confetti and explosion lines - White -->
        <path
          d="M5.5713 14.5L9.46583 18.4141M18.9996 3.60975C17.4044 3.59505 16.6658 4.33233 16.4236 5.07743C16.2103 5.73354 16.4052 7.07735 15.896 8.0727C15.4091 9.02443 14.1204 9.5617 12.6571 9.60697M20 7.6104L20.01 7.61049M19 15.96L19.01 15.9601M7.00001 3.94926L7.01001 3.94936M19 11.1094C17.5 11.1094 16.5 11.6094 15.5949 12.5447M10.2377 7.18796C11 6.10991 11.5 5.10991 11.0082 3.52734"
          stroke="#ffffff"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <!-- Confetti sparkle dots - White -->
        <circle cx="20" cy="7.61" r="1" fill="#ffffff" />
        <circle cx="19" cy="15.96" r="1" fill="#ffffff" />
        <circle cx="7" cy="3.95" r="1" fill="#ffffff" />
      </svg>
    </div>

    <!-- Title -->
    <h2
      id="modal-title"
      class="mb-3 text-center text-2xl font-bold text-khipu-white md:text-3xl"
    >
      Good News!
    </h2>

    <!-- Message -->
    <p class="mb-6 text-center text-lg text-khipu-white md:text-xl">
      Application deadline has been <span class="font-bold text-khipu-orange"
        >extended</span
      > to <span class="font-bold text-khipu-orange">February 4th, 2026</span> (Quito Time)!
    </p>

    <!-- CTA Button -->
    <button
      id="modal-got-it-btn"
      class="w-full cursor-pointer rounded-full bg-khipu-orange px-6 py-3 font-bold text-khipu-white transition hover:opacity-90 focus-visible:outline-2 focus-visible:outline-khipu-orange focus-visible:outline-offset-2"
    >
      Got it!
    </button>
  </div>
</div>

<script>
  // Modal control logic
  const modal = document.getElementById("deadline-extension-modal");
  const modalCard = document.getElementById("modal-card");
  const gotItBtn = document.getElementById("modal-got-it-btn");
  const storageKey = "khipux-deadline-extension-seen";
  // Deadline: Feb 5, 2026 00:00:00 Quito Time (ECT/UTC-5) = Feb 5, 2026 05:00:00 UTC
  const deadline = new Date("2026-02-05T05:00:00Z").getTime();

  function showModal() {
    if (modal && modalCard) {
      modal.style.display = "flex";
      // Trigger animation after display
      setTimeout(() => {
        modal.classList.remove("opacity-0");
        modalCard.classList.remove("scale-95");
        modalCard.classList.add("scale-100");
      }, 10);
    }
  }

  function hideModal() {
    if (modal && modalCard) {
      modal.classList.add("opacity-0");
      modalCard.classList.remove("scale-100");
      modalCard.classList.add("scale-95");
      setTimeout(() => {
        if (modal) modal.style.display = "none";
      }, 300);
    }
  }

  function dismissModal() {
    localStorage.setItem(storageKey, "true");
    hideModal();
  }

  // Check if modal should be shown
  function shouldShowModal() {
    // Don't show if already dismissed
    if (localStorage.getItem(storageKey) === "true") {
      return false;
    }
    // Don't show if deadline has already passed
    if (new Date().getTime() > deadline) {
      return false;
    }
    return true;
  }

  // Initialize modal on page load
  if (shouldShowModal()) {
    // Show modal after a short delay for better UX
    setTimeout(showModal, 500);
  }

  // Event listeners
  if (gotItBtn) {
    gotItBtn.addEventListener("click", dismissModal);
  }

  // Hide modal if deadline expires during session
  window.addEventListener("deadlineExpired", () => {
    hideModal();
  });
</script>
